<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>A2HS demo</title>
    <link rel="shortcut icon" type="image/ico" href="./favicon.ico"/>
    <!-- 添加 favicon icon -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no"/>
    <!-- iOS 设备 begin -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- 启用 WebApp 全屏模式 -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <!-- 隐藏状态栏/设置状态栏颜色 -->
    <meta name="apple-mobile-web-app-title" content="标题">
    <!-- 添加到主屏后的标题 -->
    <meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL">
    <!-- 添加智能 App 广告条 Smart App Banner -->

    <!-- iOS 图标 begin -->
    <link rel="apple-touch-icon-precomposed" href="/images/fox-icon.png"/>
    <!-- iPhone 和 iTouch，默认 57x57 像素，必须有 -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/fox-icon.png"/>
    <!-- Retina iPhone 和 Retina iTouch，114x114 像素，可以没有，但推荐有 -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/fox-icon.png"/>
    <!-- Retina iPad，144x144 像素，可以没有，但推荐有 -->
    <!-- iOS 图标 end -->

    <!-- iOS 启动画面 begin -->
    <link rel="apple-touch-startup-image" sizes="768x1004" href="/images/fox-icon.png"/>
    <!-- iPad 竖屏 768 x 1004（标准分辨率） -->
    <link rel="apple-touch-startup-image" sizes="1536x2008" href="/images/fox-icon.png"/>
    <!-- iPad 竖屏 1536x2008（Retina） -->
    <link rel="apple-touch-startup-image" sizes="1024x748" href="/images/fox-icon.png"/>
    <!-- iPad 横屏 1024x748（标准分辨率） -->
    <link rel="apple-touch-startup-image" sizes="2048x1496" href="/images/fox-icon.png"/>
    <!-- iPad 横屏 2048x1496（Retina） -->
 
    <link rel="apple-touch-startup-image" href="/images/fox-icon.png"/>
    <!-- iPhone/iPod Touch 竖屏 320x480 (标准分辨率) -->
    <link rel="apple-touch-startup-image" sizes="640x960" href="/images/fox-icon.png"/>
    <!-- iPhone/iPod Touch 竖屏 640x960 (Retina) -->
    <link rel="apple-touch-startup-image" sizes="640x1136" href="/images/fox-icon.png"/>
    <!-- iPhone 5/iPod Touch 5 竖屏 640x1136 (Retina) -->
    <!-- iOS 启动画面 end -->

    <!-- iOS 设备 END -->
    <meta name="format-detection" content="telphone=no, email=no"/>
    <!-- 忽略数字自动识别为电话号码 忽略识别邮箱 -->
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <!-- 转码申明：用百度打开网页可能会对其进行转码（比如贴广告），避免转码可添加如下meta。 -->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link href="./style.css" rel="stylesheet">
    <script src="./index.js" defer=""></script>
    <link rel="manifest" href="manifest.webmanifest">
    <script src="//cdn.bootcss.com/jquery/1.8.0/jquery-1.8.0.js"></script>
    <script src="//unpkg.com/dexie@latest/dist/dexie.js"></script>
    <script src="./js/swiper.min.js"></script>
    <script src="../vconsole.min.js"></script>
    <script src="./js/swiper.animate1.0.3.min.js"></script>
    <link rel="stylesheet" href="./css/swiper.min.css">
    <link rel="stylesheet" href="./css/animate.min.css">
    <style>
    .swiper-container {
      width: 300px;
      height: 300px;
      padding-top: 30px;
    }
    .swiper-slide {
      background-position: center;
      background-size: cover;
      width: 300px;
      height: 300px;
    }
    img{
        width: 100%;height: auto;
    }
</style>
  </head>
  <body>
    <div class="swiper-container">
    <div class="swiper-wrapper">
        <div class="swiper-slide"><img src="./images/fox1.jpg" alt="a fox picture"></div>
        <div class="swiper-slide"><img src="./images/fox2.jpg" alt="a fox picture"></div>
        <div class="swiper-slide"><img src="./images/fox3.jpg" alt="a fox picture"></div>
        <div class="swiper-slide"><img src="./images/fox4.jpg" alt="a fox picture"></div>
    </div>
    <!-- Add Pagination -->
    <div class="swiper-pagination"></div>
    </div>    
    <button class="add-button">Add to home screen</button>
    <button id="js-sync-event-btn" style="background: #333;color: #FFF;">同步</button>
    <button id="js-btn" style="background: #333;color: #FFF;">异步请求</button>
    <button id="js-n" style="background: #333;color: #FFF;">通知提醒</button>
    <input style="display: none;" id="js-search-input" value="789" />
    ❤️❤️❤️❤️❤️❤️❤️❤️❤️❤️
    <script>
    window.vConsole = new window.VConsole();
    var swiper = new Swiper('.swiper-container', {
      effect: 'flip',
      grabCursor: true,
      loop: true,
      autoplay:true,
      pagination: {
        el: '.swiper-pagination',
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });
    </script>        
    <script>
// 在主页添加后台同步,断网后重连在次调用,在sw里有处理事件, sw要先初始化.
var tag = 'sample_sync'
if ('serviceWorker' in navigator && 'SyncManager' in window) {
    navigator.serviceWorker.ready.then(function (registration) {
        document.getElementById('js-sync-event-btn').addEventListener('click', function () {
            registration.sync.register(tag).then(function () {
                console.log('后台同步已触发', tag);
                // 使用postMessage进行数据通信
                var inputValue = document.querySelector('#js-search-input').value;
                var msg = JSON.stringify({type: 'bgsync', msg: {name: inputValue}});
                navigator.serviceWorker.controller.postMessage(msg);
            }).catch(function (err) {
                console.log('后台同步触发失败', err);
            });
            // showNotification 能够设置actions，更过的按钮，在swjs里监听
            Notification.requestPermission(function(result) {
                if (result === 'granted') {
                navigator.serviceWorker.ready.then(function(registration) {
                    registration.showNotification('Vibration Sample', {
                    body: 'Buzz! Buzz!',
                    icon: '/A2HS/images/fox1.jpg',
                    vibrate: [200, 100, 200, 100, 200, 100, 200],
                    tag: 'vibration-sample',
                    actions: [
                        {
                            action: 'coffee-action',
                            title: 'Coffee',
                            icon: '/A2HS/images/fox3.jpg'
                        },
                        {
                            action: 'doughnut-action',
                            title: 'Doughnut',
                            icon: '/A2HS/images/fox4.jpg'
                        }]
                    });
                });
                }
            });
        });
    });
}
        // $.ajax({
        //         url: 'https://gw-passenger-wap.01zhuanche.com/gw-passenger-wap/zhuanche-passenger/passenger/charge/getServiceType',
        //         type: 'post',
        // 		data: {cid: 44},
        //         dataType:"json",
        //         success: function(data) {console.log(data)},
        //         timeout: 3000           
        //     });
		$.ajax({
            url: 'https://www.apiopen.top/weatherApi?city=成都',
            type: 'get',
            dataType:"json",
            success: function(data) {console.log(data)},
            timeout: 3000           
        });
	  
	  // 下边代码 如果有caches里有异步缓存,在没网的时候调用cache里的数据,有网先用cache数据渲染,等fetch回来了在替换cache.
function getApiDataFromCache(url) {
    if ('caches' in window) {
        return caches.match(url).then(function (cache) {
            if (!cache) {
                return;
            }
            return cache.json();
        });
    }
    else {
        return Promise.resolve();
    }
}
function getApiDataRemote(url) {
	return new Promise((resolve, reject) => {
		$.ajax({
		        url: url,
		        type: 'get',
		        dataType:"json",
		        success: function(data) {console.log(data)
					resolve(data)
				},
		        timeout: 3000           
		    });
	})
}
function queryBook(url) {
    // 远程请求
    var remotePromise = getApiDataRemote(url);
    var cacheData;
    // 首先使用缓存数据渲染
    getApiDataFromCache(url).then(function (data) {
        if (data) {           
            console.log(data);
        }
        cacheData = data || {};
        return remotePromise;
    }).then(function (data) {
        if (JSON.stringify(data) !== JSON.stringify(cacheData)) {
            console.log(data);
        }
    })
}
document.getElementById('js-btn').addEventListener('click', function () {
	queryBook('https://www.apiopen.top/weatherApi?city=成都')
})
document.getElementById('js-n').addEventListener('click', function () {
    if(window.Notification) {
        if(window.Notification.permission == "granted") {
            var notification = new Notification('你有一条新信息', {
                body: "你好我是王小婷"
            });
        } else {
            window.Notification.requestPermission();
        }
    } else alert('你的浏览器不支持此消息提示功能，请使用chrome内核的浏览器！');
})
    </script>
</body></html>